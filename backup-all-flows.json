[{"id":"db682bb3.2d0f28","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"f43e7e92.ed516","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/stats/ingredients","method":"post","upload":false,"swaggerDoc":"","x":140,"y":380,"wires":[["e8236678.e2095"]]},{"id":"8cc802b4.ee21b","type":"http response","z":"db682bb3.2d0f28","name":"Repsonse","statusCode":"200","headers":{},"x":1080,"y":420,"wires":[]},{"id":"213f55b6.a0d44a","type":"function","z":"db682bb3.2d0f28","name":"Save History","func":"cost_recipe = msg.payload.cost_recipe\nrecipe_ingredients = msg.payload.ingredients\nrecipe_name = msg.payload.Name\n\nvar costHist = global.get(\"costHist\")\nvar recipesHist = global.get(\"recipesHist\")\nvar stats = global.get(\"stats\")\n\n\nif (costHist === undefined){\n    var locCostHist = [];\n    global.set(\"costHist\", locCostHist)\n    costHist.push(cost_recipe)\n\n} else {\n    costHist.push(cost_recipe)\n}\n\n\n\nvar costHistTotal = costHist.reduce((a, b) => a + b, 0)\nvar n_recipesTotal = costHist.length\nvar averageCost = costHistTotal/n_recipesTotal\nvar averageWorldsConsumed = averageCost/15\nvar averageColor = averageCost/30\n\nvar stats = {  \n        \"costHistTotal\": costHistTotal,\n        \"n_recipesTotal\": n_recipesTotal,\n        \"averageCost\": averageCost,\n        \"averageWorldsConsumed\": averageCost/2,\n        \"averageColor\": averageColor\n    }\n\nrecipe = {\"Name\": recipe_name,\"userRecipeCost\": cost_recipe,\"ingredients\": recipe_ingredients}    \nif (recipesHist === undefined){\n    var locRecipesHist = [];\n    global.set(\"recipesHist\", locRecipesHist)\n    recipesHist.push(recipe)\n} else {\n    recipesHist.push(recipe)\n\n}\n\n\nglobal.set(\"stats\", stats)\n\n\ndelete msg.payload.ingredients\ndelete msg.payload.Name\n\nmsg.payload.userRecipeCostArray = costHist\nmsg.payload.allRecipes = recipesHist\nmsg.payload.stats = stats\n\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":420,"wires":[["8cc802b4.ee21b"]]},{"id":"2ebd3643.7e3a7a","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/recipes","method":"delete","upload":false,"swaggerDoc":"","x":160,"y":520,"wires":[["f615f709.ae4f98"]]},{"id":"f615f709.ae4f98","type":"function","z":"db682bb3.2d0f28","name":"Delete History","func":"var locCostHist = [];\nglobal.set(\"costHist\", locCostHist)\n\nvar locRecipesHist = [];\nglobal.set(\"recipesHist\", locRecipesHist)\n\n\nvar locStats = [];\nglobal.set(\"stats\", locStats)\n\n\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":520,"wires":[["b2c03087.e53758"]]},{"id":"b2c03087.e53758","type":"http response","z":"db682bb3.2d0f28","name":"Repsonse","statusCode":"200","headers":{},"x":1080,"y":520,"wires":[]},{"id":"67c4b036.59ad1","type":"http response","z":"db682bb3.2d0f28","name":"Repsonse","statusCode":"","headers":{},"x":1080,"y":380,"wires":[]},{"id":"3c39530b.0ff5b4","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/recipes","method":"post","upload":false,"swaggerDoc":"","x":170,"y":420,"wires":[["badc0991.de07b8"]]},{"id":"badc0991.de07b8","type":"function","z":"db682bb3.2d0f28","name":"Load Database","func":"node.warn('I am in Load Database function, payload:')\nnode.warn(msg.payload)\n\nmsg.payload.ingredientsDB = [\n    {\n      Product: 'Almond milk',\n      CO2: 1.09,\n      Energy: 1.09,\n      Water: 1.09\n    },\n    {\n      Product: 'Almonds',\n      CO2: 2.18,\n      Energy: 26.31,\n      Water: 1.9\n    },\n    {\n      Product: 'Beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Cheese slices',\n      CO2: 8.29,\n      Energy: 35.5,\n      Water: 0.15\n    },\n    {\n      Product: 'Cheese spread',\n      CO2: 6.2,\n      Energy: 26.71,\n      Water: 0.11\n    },\n    {\n      Product: 'Chicken',\n      CO2: 6.82,\n      Energy: 64.14,\n      Water: 0.34\n    },\n    {\n      Product: 'Chocolate',\n      CO2: 14.67,\n      Energy: 90.25,\n      Water: 0.38\n    },\n    {\n      Product: 'Chocolate milk',\n      CO2: 4.65,\n      Energy: 26.92,\n      Water: 0.11\n    },\n    {\n      Product: 'Corn',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Dried Beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Dry Pasta',\n      CO2: 1.49,\n      Energy: 17.23,\n      Water: 0.01\n    },\n    {\n      Product: 'Fresh ravioli with meat',\n      CO2: 10.25,\n      Energy: 66.22,\n      Water: 0.16\n    },\n    {\n      Product: 'Fresh ravioli with spinach and ricotta',\n      CO2: 3.06,\n      Energy: 20.38,\n      Water: 0.04\n    },\n    {\n      Product: 'Gruy\\ufffdre',\n      CO2: 8.29,\n      Energy: 35.5,\n      Water: 0.15\n    },\n    {\n      Product: 'Ham',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Lentils',\n      CO2: 0.78,\n      Energy: 5.67,\n      Water: 0.14\n    },\n    {\n      Product: 'Low fat organic milk',\n      CO2: 1.11,\n      Energy: 1.39,\n      Water: 0\n    },\n    {\n      Product: 'Non-free range eggs',\n      CO2: 3.94,\n      Energy: 36.1,\n      Water: 0.18\n    },\n    {\n      Product: 'Pancetta',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Pork',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Pork sausages',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Quorn',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Red kidney beans',\n      CO2: 0.78,\n      Energy: 5.67,\n      Water: 0.14\n    },\n    {\n      Product: 'Rice milk',\n      CO2: 0.26,\n      Energy: 0.26,\n      Water: 0.26\n    },\n    {\n      Product: 'Risotto rice',\n      CO2: 1.03,\n      Energy: 5.43,\n      Water: 0.35\n    },\n    {\n      Product: 'Sliced beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Sliced chicken',\n      CO2: 6.8,\n      Energy: 64,\n      Water: 0.34\n    },\n    {\n      Product: 'Smoked cheese',\n      CO2: 6.2,\n      Energy: 26.71,\n      Water: 0.11\n    },\n    {\n      Product: 'Spaghetti Carbonara pre-made meal',\n      CO2: 3.44,\n      Energy: 28.52,\n      Water: 0.11\n    },\n    {\n      Product: 'Tofu',\n      CO2: 3.23,\n      Energy: 14.37,\n      Water: 0\n    },\n    {\n      Product: 'UHT milk',\n      CO2: 1.31,\n      Energy: 5.82,\n      Water: 0.02\n    },\n    {\n      Product: 'Vegetarian salami',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Wholegrain dry pasta',\n      CO2: 1.49,\n      Energy: 17.23,\n      Water: 0.01\n    },\n    {\n      Product: 'Lamb',\n      CO2: 25.44,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Butter',\n      CO2: 11.52,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Turkey',\n      CO2: 5.9,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Rabbit',\n      CO2: 3.61,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Cod',\n      CO2: 3.49,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Eggs',\n      CO2: 3.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Insect',\n      CO2: 2.3,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Whole Milk',\n      CO2: 1.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Wheat',\n      CO2: 0.51,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Peas',\n      CO2: 0.6,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Barley',\n      CO2: 0.52,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Chickpeas',\n      CO2: 0.67,\n      Energy: '',\n      Water: ''\n    },\n    //Added made up Entries..................................\n    {\n      Product: 'Onions',\n      CO2: 0.2,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Tomatoes',\n      CO2: 0.6,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Carrots',\n      CO2: 0.3,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Celery',\n      CO2: 0.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Red wine',\n      CO2: 1.5,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'White Flour',\n      CO2: 0.55,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Red wine',\n      CO2: 1.5,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Olive oil',\n      CO2: 0.8,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Garlic',\n      CO2: 0.2,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Aubergine',\n      CO2: 0.32,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Pepper',\n      CO2: 0.35,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Courgette',\n      CO2: 0.31,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Cream',\n      CO2: 2.1,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Strawberries',\n      CO2: 0.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Biscuits',\n      CO2: 2.5,\n      Energy: '',\n      Water: ''\n    },\n  ]\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":420,"wires":[["f0fad20a.377c"]]},{"id":"f0fad20a.377c","type":"function","z":"db682bb3.2d0f28","name":"Calculate cost recipe","func":"ingredientsDB = msg.payload.ingredientsDB;\ningredients = msg.payload.ingredients\n\n\nn_ingredients = ingredients.length;\nn_ingredients_db = ingredientsDB.length;\nvar cost_recipe = 0;\n\nvar i; \nvar j;\n\nvar ingredient;\nvar amount;\n\n\nfor (j=0; j < n_ingredients;j++){\n\n    ingredient = ingredients[j].Product;\n    amount = ingredients[j].kg;\n    \n\n    for (i=0; i < n_ingredients_db;i++){\n\n        if(ingredient == ingredientsDB[i].Product){\n            cost_recipe += ingredientsDB[i].CO2 * amount;\n            // cost_ingredients[j] = ingredientsDB[i].CO2 * amount;\n            ingredients[j].CO2 = ingredientsDB[i].CO2 * amount\n            // ingredients[j].CO3 = amount\n\n            break;\n        }\n    }\n}\n\nmsg.payload.cost_recipe = cost_recipe\nmsg.payload.worldsConsumed = cost_recipe/15\nmsg.payload.color = cost_recipe/30\n\ndelete msg.payload.ingredientsDB\n\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":420,"wires":[["213f55b6.a0d44a"]]},{"id":"7f8353b8.16f584","type":"function","z":"db682bb3.2d0f28","name":"Load History","func":"\nvar costHist = global.get(\"costHist\")\nvar recipesHist = global.get(\"recipesHist\")\nvar stats = global.get(\"stats\")\n\n\nif (costHist === undefined){\n    node.warn('costHist undefined')\n}\n\nif (recipesHist === undefined){\n    node.warn('recipesHist undefined')\n}\n\nif (stats === undefined){\n    node.warn('stats undefined')\n}\n\n\ndelete msg.payload.ingredients\n\nmsg.payload.userRecipeCostArray = costHist\nmsg.payload.allRecipes = recipesHist\nmsg.payload.stats = stats\n\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":460,"wires":[["690dc798.210918"]]},{"id":"8a0c0199.0e0e6","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/recipes","method":"get","upload":false,"swaggerDoc":"","x":170,"y":460,"wires":[["7f8353b8.16f584"]]},{"id":"690dc798.210918","type":"http response","z":"db682bb3.2d0f28","name":"Repsonse","statusCode":"200","headers":{},"x":1080,"y":460,"wires":[]},{"id":"9a824c66.0ec488","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/history","method":"get","upload":false,"swaggerDoc":"","x":170,"y":600,"wires":[["64b3db97.bce634"]]},{"id":"64b3db97.bce634","type":"function","z":"db682bb3.2d0f28","name":"WriteHistory","func":"msg.payload = \n [1.4, 1.6, 1.3, 1.2, 1.4, 1.6, 1.2, 0.9, 1.0, 1.0, 0.9, 0.8, 0.9, 0.7, 0.8]\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":600,"wires":[["1009d19.b09852e"]]},{"id":"1009d19.b09852e","type":"http response","z":"db682bb3.2d0f28","name":"Response","statusCode":"200","headers":{},"x":1080,"y":600,"wires":[]},{"id":"e8236678.e2095","type":"function","z":"db682bb3.2d0f28","name":"Load Database","func":"msg.payload.ingredientsDB = [\n    {\n      Product: 'Almond milk',\n      CO2: 1.09,\n      Energy: 1.09,\n      Water: 1.09\n    },\n    {\n      Product: 'Almonds',\n      CO2: 2.18,\n      Energy: 26.31,\n      Water: 1.9\n    },\n    {\n      Product: 'Beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Cheese slices',\n      CO2: 8.29,\n      Energy: 35.5,\n      Water: 0.15\n    },\n    {\n      Product: 'Cheese spread',\n      CO2: 6.2,\n      Energy: 26.71,\n      Water: 0.11\n    },\n    {\n      Product: 'Chicken',\n      CO2: 6.82,\n      Energy: 64.14,\n      Water: 0.34\n    },\n    {\n      Product: 'Chocolate',\n      CO2: 14.67,\n      Energy: 90.25,\n      Water: 0.38\n    },\n    {\n      Product: 'Chocolate milk',\n      CO2: 4.65,\n      Energy: 26.92,\n      Water: 0.11\n    },\n    {\n      Product: 'Corn',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Dried Beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Dry Pasta',\n      CO2: 1.49,\n      Energy: 17.23,\n      Water: 0.01\n    },\n    {\n      Product: 'Fresh ravioli with meat',\n      CO2: 10.25,\n      Energy: 66.22,\n      Water: 0.16\n    },\n    {\n      Product: 'Fresh ravioli with spinach and ricotta',\n      CO2: 3.06,\n      Energy: 20.38,\n      Water: 0.04\n    },\n    {\n      Product: 'Gruy\\ufffdre',\n      CO2: 8.29,\n      Energy: 35.5,\n      Water: 0.15\n    },\n    {\n      Product: 'Ham',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Lentils',\n      CO2: 0.78,\n      Energy: 5.67,\n      Water: 0.14\n    },\n    {\n      Product: 'Low fat organic milk',\n      CO2: 1.11,\n      Energy: 1.39,\n      Water: 0\n    },\n    {\n      Product: 'Non-free range eggs',\n      CO2: 3.94,\n      Energy: 36.1,\n      Water: 0.18\n    },\n    {\n      Product: 'Pancetta',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Pork',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Pork sausages',\n      CO2: 10.76,\n      Energy: 91.4,\n      Water: 0.52\n    },\n    {\n      Product: 'Quorn',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Red kidney beans',\n      CO2: 0.78,\n      Energy: 5.67,\n      Water: 0.14\n    },\n    {\n      Product: 'Rice milk',\n      CO2: 0.26,\n      Energy: 0.26,\n      Water: 0.26\n    },\n    {\n      Product: 'Risotto rice',\n      CO2: 1.03,\n      Energy: 5.43,\n      Water: 0.35\n    },\n    {\n      Product: 'Sliced beef',\n      CO2: 27.76,\n      Energy: 164.22,\n      Water: 0.47\n    },\n    {\n      Product: 'Sliced chicken',\n      CO2: 6.8,\n      Energy: 64,\n      Water: 0.34\n    },\n    {\n      Product: 'Smoked cheese',\n      CO2: 6.2,\n      Energy: 26.71,\n      Water: 0.11\n    },\n    {\n      Product: 'Spaghetti Carbonara pre-made meal',\n      CO2: 3.44,\n      Energy: 28.52,\n      Water: 0.11\n    },\n    {\n      Product: 'Tofu',\n      CO2: 3.23,\n      Energy: 14.37,\n      Water: 0\n    },\n    {\n      Product: 'UHT milk',\n      CO2: 1.31,\n      Energy: 5.82,\n      Water: 0.02\n    },\n    {\n      Product: 'Vegetarian salami',\n      CO2: 0.19,\n      Energy: 1.88,\n      Water: 0.06\n    },\n    {\n      Product: 'Wholegrain dry pasta',\n      CO2: 1.49,\n      Energy: 17.23,\n      Water: 0.01\n    },\n    {\n      Product: 'Lamb',\n      CO2: 25.44,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Butter',\n      CO2: 11.52,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Turkey',\n      CO2: 5.9,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Rabbit',\n      CO2: 3.61,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Cod',\n      CO2: 3.49,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Eggs',\n      CO2: 3.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Insect',\n      CO2: 2.3,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Whole Milk',\n      CO2: 1.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Wheat',\n      CO2: 0.51,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Peas',\n      CO2: 0.6,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Barley',\n      CO2: 0.52,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Chickpeas',\n      CO2: 0.67,\n      Energy: '',\n      Water: ''\n    },\n    //Added made up Entries..................................\n    {\n      Product: 'Onions',\n      CO2: 0.2,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Tomatoes',\n      CO2: 0.6,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Carrots',\n      CO2: 0.3,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Celery',\n      CO2: 0.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Red wine',\n      CO2: 1.5,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'White Flour',\n      CO2: 0.55,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Red wine',\n      CO2: 1.5,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Olive oil',\n      CO2: 0.8,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Garlic',\n      CO2: 0.2,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Aubergine',\n      CO2: 0.32,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Pepper',\n      CO2: 0.35,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Courgette',\n      CO2: 0.31,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Cream',\n      CO2: 2.1,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Strawberries',\n      CO2: 0.4,\n      Energy: '',\n      Water: ''\n    },\n    {\n      Product: 'Biscuits',\n      CO2: 2.5,\n      Energy: '',\n      Water: ''\n    },\n  ]\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":380,"wires":[["64ec6ef.31acb9"]]},{"id":"64ec6ef.31acb9","type":"function","z":"db682bb3.2d0f28","name":"Calculate cost recipe","func":"ingredientsDB = msg.payload.ingredientsDB;\ningredients = msg.payload.ingredients\n\n\nn_ingredients = ingredients.length;\nn_ingredients_db = ingredientsDB.length;\nvar cost_recipe = 0;\n\nvar i; \nvar j;\n\nvar ingredient;\nvar amount;\n\n\nfor (j=0; j < n_ingredients;j++){\n\n    ingredient = ingredients[j].Product;\n    amount = ingredients[j].kg;\n    \n\n    for (i=0; i < n_ingredients_db;i++){\n\n        if(ingredient == ingredientsDB[i].Product){\n            cost_recipe += ingredientsDB[i].CO2 * amount;\n            // cost_ingredients[j] = ingredientsDB[i].CO2 * amount;\n            ingredients[j].CO2 = ingredientsDB[i].CO2 * amount\n            // ingredients[j].CO3 = amount\n\n            break;\n        }\n    }\n}\n\nmsg.payload.cost_recipe = cost_recipe\nmsg.payload.worldsConsumed = cost_recipe/15\nmsg.payload.color = cost_recipe/30\n\ndelete msg.payload.ingredientsDB\n\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":380,"wires":[["67c4b036.59ad1"]]},{"id":"f1a574ef.86e218","type":"http in","z":"db682bb3.2d0f28","name":"","url":"/rankings","method":"get","upload":false,"swaggerDoc":"","x":150,"y":640,"wires":[["59cd0d1b.0af20c"]]},{"id":"59cd0d1b.0af20c","type":"function","z":"db682bb3.2d0f28","name":"WriteRankings","func":"msg.payload.rankings_sorted = \n [0.7, 0.8, 0.8,0.9, 1.0, 1.1,1.1, 1.2, 1.4, 1.4, 1.5, 1.8, 1.9, 2.1, 2.3]\n \nmsg.payload.usersID_sorted = \n [1, 14, 15, 13, 8, 11, 9, 7, 3, 2, 6, 12,4, 10, 5]\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":640,"wires":[["15056981.59f146"]]},{"id":"e013c88d.6d6908","type":"http response","z":"db682bb3.2d0f28","name":"Response","statusCode":"200","headers":{},"x":1080,"y":640,"wires":[]},{"id":"15056981.59f146","type":"function","z":"db682bb3.2d0f28","name":"computeRanking","func":"rankings_others = msg.payload.rankings_sorted\nusersID_others = msg.payload.usersID_sorted\n\nvar stats = global.get(\"stats\")\nranking_user = stats.costHistTotal\n\n// add it into ranking, loop through ranking for this\n\n\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":640,"wires":[["e013c88d.6d6908"]]}]