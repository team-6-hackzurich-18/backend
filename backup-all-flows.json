[{"id":"ec8c2f50.80329","type":"function","z":"ca0c3aa0.342be8","name":"Save History","func":"cost_recipe = msg.payload.cost_recipe\nrecipe_ingredients = msg.payload.ingredients\nrecipe_name = msg.payload.Name\n\nvar costHist = global.get(\"costHist\")\nvar recipesHist = global.get(\"recipesHist\")\nvar stats = global.get(\"stats\")\n\n\nif (costHist === undefined){\n    var locCostHist = [];\n    global.set(\"costHist\", locCostHist)\n    costHist.push(cost_recipe)\n\n} else {\n    costHist.push(cost_recipe)\n}\n\n\n\nvar costHistTotal = costHist.reduce((a, b) => a + b, 0)\nvar n_recipesTotal = costHist.length\nvar averageCost = costHistTotal/n_recipesTotal\nvar averageWorldsConsumed = averageCost/15\nvar averageColor = averageCost/30\n\nvar stats = {  \n        \"costHistTotal\": costHistTotal,\n        \"n_recipesTotal\": n_recipesTotal,\n        \"averageCost\": averageCost,\n        \"averageWorldsConsumed\": averageWorldsConsumed,\n        \"averageColor\": averageColor\n    }\n\nrecipe = {\"Name\": recipe_name,\"userRecipeCost\": cost_recipe,\"ingredients\": recipe_ingredients}    \nif (recipesHist === undefined){\n    var locRecipesHist = [];\n    global.set(\"recipesHist\", locRecipesHist)\n    recipesHist.push(recipe)\n} else {\n    recipesHist.push(recipe)\n\n}\n\n\nglobal.set(\"stats\", stats)\n\n\ndelete msg.payload.ingredients\ndelete msg.payload.Name\n\nmsg.payload.userRecipeCostArray = costHist\nmsg.payload.allRecipes = recipesHist\nmsg.payload.stats = stats\n\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":420,"wires":[["cd9d44b0.299df8"]]}]
